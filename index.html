<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>La Mia Galleria Fotografica</title>
    <style>
      :root {
        --bg-color: #121212;
        --text-color: #f5f5f5;
        --card-bg: #1e1e1e;
        --accent: #8e79f5;
        --overlay-bg: rgba(0, 0, 0, 0.9);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
          Roboto, sans-serif;
        background-color: var(--bg-color);
        color: var(--text-color);
        line-height: 1.6;
        padding: 0;
        margin: 0;
      }

      header {
        padding: 2rem 1.5rem;
        text-align: center;
        background-color: rgba(0, 0, 0, 0.4);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid #333;

        top: 0;
        z-index: 10;
      }

      .header-content {
        max-width: 800px;
        margin: 0 auto;
      }

      h1 {
        font-size: 2.5rem;
        margin-bottom: 1rem;
        font-weight: 800;
        background: linear-gradient(45deg, var(--accent), #41e7c7);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
      }

      .subtitle {
        font-size: 1.1rem;
        opacity: 0.8;
        max-width: 600px;
        margin: 0 auto;
      }

      .gallery-container {
        max-width: 1400px;
        margin: 2rem auto;
        padding: 0 1rem;
      }

      .bento-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));

        gap: 1rem;
      }

      @media (min-width: 768px) {
        .bento-grid {
          grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
          grid-auto-rows: 220px;
        }

        .card:nth-child(4n + 1) {
          grid-column: span 2;
          grid-row: span 2;
        }

        .card:nth-child(8n + 5) {
          grid-column: span 2;
        }
      }

      .card {
        border-radius: 1rem;
        overflow: hidden;
        background-color: var(--card-bg);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        cursor: pointer;
        position: relative;
      }

      .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
      }

      .card img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: filter 0.3s ease;
      }

      .card:hover img {
        filter: brightness(1.1);
      }

      .fullscreen-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: var(--overlay-bg);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        backdrop-filter: blur(5px);
      }

      .fullscreen-image {
        max-width: 95%;
        max-height: 95%;
        object-fit: contain;
        border-radius: 8px;
        box-shadow: 0 5px 25px rgba(0, 0, 0, 0.5);
      }

      .close-button {
        position: absolute;
        top: 2rem;
        right: 2rem;
        background: rgba(0, 0, 0, 0.6);
        color: white;
        border: none;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 1.5rem;
        transition: background 0.3s;
      }

      .close-button:hover {
        background: rgba(255, 255, 255, 0.2);
      }

      footer {
        text-align: center;
        padding: 2rem 1rem;
        background-color: rgba(0, 0, 0, 0.4);
        margin-top: 3rem;
        border-top: 1px solid #333;
      }

      .social-links {
        display: flex;
        justify-content: center;
        gap: 1.5rem;
        margin-top: 1rem;
      }

      .social-links a {
        color: var(--text-color);
        text-decoration: none;
        transition: color 0.3s;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .social-links a:hover {
        color: var(--accent);
      }

      .social-icon {
        width: 24px;
        height: 24px;
      }

      .loading {
        display: flex;
        justify-content: center;
        padding: 3rem;
        font-size: 1.2rem;
        color: var(--accent);
      }

      /* Aggiunto per la gestione del caricamento e blurring */
      .card img {
        filter: blur(0);
        transition: filter 0.5s ease;
      }

      .card img.loading {
        filter: blur(10px);
      }

      /* Indicatore di caricamento per immagine a schermo intero */
      .fullscreen-loading {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: var(--accent);
        font-size: 1.2rem;
        display: none;
      }
    </style>
  </head>
  <body>
    <header>
      <div class="header-content">
        <h1>My best shots</h1>
        <p class="subtitle">If you use them, please remember to credit me.</p>
      </div>
    </header>

    <main class="gallery-container">
      <div class="bento-grid" id="gallery">
        <div class="loading">Caricamento galleria...</div>
      </div>
    </main>

    <div class="fullscreen-overlay" id="overlay">
      <img
        src=""
        alt="Immagine a schermo intero"
        class="fullscreen-image"
        id="fullscreen-img"
      />
      <div class="fullscreen-loading" id="fullscreen-loading">
        Caricamento immagine in alta qualità...
      </div>
      <button class="close-button" id="close-button">✕</button>
    </div>

    <footer>
     
      <div class="social-links">
        <a href="https://bento.me/photomark" target="_blank">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
          >
            <path
              fill="currentColor"
              d="M16.36 14c.08-.66.14-1.32.14-2s-.06-1.34-.14-2h3.38c.16.64.26 1.31.26 2s-.1 1.36-.26 2m-5.15 5.56c.6-1.11 1.06-2.31 1.38-3.56h2.95a8.03 8.03 0 0 1-4.33 3.56M14.34 14H9.66c-.1-.66-.16-1.32-.16-2s.06-1.35.16-2h4.68c.09.65.16 1.32.16 2s-.07 1.34-.16 2M12 19.96c-.83-1.2-1.5-2.53-1.91-3.96h3.82c-.41 1.43-1.08 2.76-1.91 3.96M8 8H5.08A7.92 7.92 0 0 1 9.4 4.44C8.8 5.55 8.35 6.75 8 8m-2.92 8H8c.35 1.25.8 2.45 1.4 3.56A8 8 0 0 1 5.08 16m-.82-2C4.1 13.36 4 12.69 4 12s.1-1.36.26-2h3.38c-.08.66-.14 1.32-.14 2s.06 1.34.14 2M12 4.03c.83 1.2 1.5 2.54 1.91 3.97h-3.82c.41-1.43 1.08-2.77 1.91-3.97M18.92 8h-2.95a15.7 15.7 0 0 0-1.38-3.56c1.84.63 3.37 1.9 4.33 3.56M12 2C6.47 2 2 6.5 2 12a10 10 0 0 0 10 10a10 10 0 0 0 10-10A10 10 0 0 0 12 2"
            />
          </svg>
          bento.me/photomark
        </a>
        <a href="https://instagram.com/photo.mark3" target="_blank">
          <svg
            class="social-icon"
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
            <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
            <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
          </svg>
          photo.mark3
        </a>
      </div>
    </footer>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const gallery = document.getElementById("gallery");
        const overlay = document.getElementById("overlay");
        const fullscreenImg = document.getElementById("fullscreen-img");
        const fullscreenLoading = document.getElementById("fullscreen-loading");
        const closeButton = document.getElementById("close-button");

        // Funzione per creare una versione ridotta dell'URL dell'immagine (anteprima)
        function createThumbnailUrl(originalUrl) {
          // Usa l'API di generazione thumbnail se disponibile, altrimenti ridimensiona con canvas
          // Per questo esempio usiamo una soluzione client-side
          return originalUrl + "?thumbnail=true";
        }

        // Funzione per caricare tutte le immagini dal file images.txt
        async function loadImages() {
          try {
            // Carica il file images.txt
            const response = await fetch("./images.txt");
            if (!response.ok) {
              throw new Error("Impossibile caricare il file images.txt");
            }

            const content = await response.text();
            // Divide il contenuto in righe e rimuove le righe vuote
            const imageFiles = content
              .split("\n")
              .map((line) => line.trim())
              .filter((line) => line && !line.startsWith("#"));

            // Rimuovi il messaggio di caricamento
            gallery.innerHTML = "";

            // Se non ci sono immagini
            if (imageFiles.length === 0) {
              gallery.innerHTML =
                '<p style="grid-column: 1/-1; text-align: center;">Nessuna immagine trovata nel file images.txt.</p>';
              return;
            }

            // Aggiungi le immagini alla griglia
            imageFiles.forEach((filename, index) => {
              const card = document.createElement("div");
              card.className = "card";

              // URL originale (alta risoluzione)
              const originalUrl = `./${filename}`;

              // Crea l'elemento immagine con versione a bassa risoluzione
              const imgEl = document.createElement("img");

              // Crea una dimensione ridotta per l'anteprima (circa 800px max)
              const imgPreview = new Image();
              imgPreview.crossOrigin = "anonymous";
              imgPreview.src = originalUrl;
              imgPreview.className = "loading";

              imgPreview.onload = function () {
                // Usa canvas per creare una versione ridotta dell'immagine
                const canvas = document.createElement("canvas");
                const ctx = canvas.getContext("2d");

                // Calcola dimensioni mantenendo le proporzioni
                let width = imgPreview.width;
                let height = imgPreview.height;
                const maxDimension = 800;

                if (width > height && width > maxDimension) {
                  height = (height * maxDimension) / width;
                  width = maxDimension;
                } else if (height > maxDimension) {
                  width = (width * maxDimension) / height;
                  height = maxDimension;
                }

                canvas.width = width;
                canvas.height = height;

                // Disegna l'immagine ridimensionata sul canvas
                ctx.drawImage(imgPreview, 0, 0, width, height);

                // Usa questa come miniatura
                try {
                  imgEl.src = canvas.toDataURL("image/jpeg", 0.7); // Qualità ridotta per risparmiare banda
                  imgEl.classList.remove("loading");
                } catch (e) {
                  // Se c'è un errore CORS, usa direttamente l'URL originale
                  imgEl.src = originalUrl;
                  imgEl.classList.remove("loading");
                  console.warn("Impossibile creare anteprima: ", e);
                }
              };

              // In caso di errore nel caricamento dell'anteprima
              imgPreview.onerror = function () {
                imgEl.src = originalUrl;
                imgEl.classList.remove("loading");
                console.warn("Errore nel caricamento dell'anteprima");
              };

              imgEl.alt = `Foto ${index + 1}`;
              imgEl.loading = "lazy"; // Caricamento lazy per prestazioni migliori

              card.appendChild(imgEl);
              gallery.appendChild(card);

              // Aggiungi l'evento click per la modalità a schermo intero
              card.addEventListener("click", function () {
                // Mostra messaggio di caricamento
                fullscreenLoading.style.display = "block";

                // Carica l'immagine in alta risoluzione
                fullscreenImg.src = ""; // Reset per forzare il caricamento
                fullscreenImg.src = originalUrl;
                fullscreenImg.alt = `Foto ${index + 1}`;

                // Mostra l'overlay
                overlay.style.display = "flex";
                document.body.style.overflow = "hidden"; // Impedisce lo scorrimento

                // Nascondi il messaggio di caricamento quando l'immagine è caricata
                fullscreenImg.onload = function () {
                  fullscreenLoading.style.display = "none";
                };

                // Gestisci errore di caricamento
                fullscreenImg.onerror = function () {
                  fullscreenLoading.textContent =
                    "Errore nel caricamento dell'immagine";
                  setTimeout(() => {
                    fullscreenLoading.style.display = "none";
                  }, 2000);
                };
              });
            });
          } catch (error) {
            console.error("Errore nel caricamento delle immagini:", error);
            gallery.innerHTML =
              '<p style="grid-column: 1/-1; text-align: center;">Errore nel caricamento delle immagini: ' +
              error.message +
              "</p>";
          }
        }

        // Chiudi l'overlay quando si clicca sul pulsante di chiusura
        closeButton.addEventListener("click", function () {
          overlay.style.display = "none";
          document.body.style.overflow = ""; // Ripristina lo scorrimento
          fullscreenImg.src = ""; // Libera memoria
        });

        // Chiudi l'overlay anche quando si clicca al di fuori dell'immagine
        overlay.addEventListener("click", function (e) {
          if (e.target === overlay) {
            overlay.style.display = "none";
            document.body.style.overflow = "";
            fullscreenImg.src = ""; // Libera memoria
          }
        });

        // Previeni la chiusura quando si clicca sull'immagine stessa
        fullscreenImg.addEventListener("click", function (e) {
          e.stopPropagation();
        });

        // Aggiungi supporto per chiudere con il tasto ESC
        document.addEventListener("keydown", function (e) {
          if (e.key === "Escape" && overlay.style.display === "flex") {
            overlay.style.display = "none";
            document.body.style.overflow = "";
            fullscreenImg.src = ""; // Libera memoria
          }
        });

        // Carica le immagini all'avvio
        loadImages();
      });
    </script>
  </body>
</html>
